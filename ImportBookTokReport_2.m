function BooktTokcosacinascondi = ImportBookTokReport_2(filename, dataLines)
%IMPORTFILE Import data from a text file
%  BOOKTTOKCOSACINASCONDI = IMPORTFILE(FILENAME) reads data from text
%  file FILENAME for the default selection.  Returns the data as a table.
%
%  BOOKTTOKCOSACINASCONDI = IMPORTFILE(FILE, DATALINES) reads data for
%  the specified row interval(s) of text file FILENAME. Specify
%  DATALINES as a positive scalar integer or a N-by-2 array of positive
%  scalar integers for dis-contiguous row intervals.
%
%  Example:
%  BooktTokcosacinascondi = importfile("/home/alfy/Documents/DatiTesiElisa/1-BooktTok, cosa ci nascondi.csv", [2, Inf]);
%
%  See also READTABLE.
%
% Auto-generated by MATLAB on 21-Jan-2023 17:10:24

%% Input handling

% If dataLines is not specified, define defaults
if nargin < 2
    dataLines = [2, Inf];
end

%% Set up the Import Options and import the data
opts = delimitedTextImportOptions("NumVariables", 49);

% Specify range and delimiter
opts.DataLines = dataLines;
opts.Delimiter = ",";

% Specify column names and types
opts.VariableNames = ["InformazioniCronologiche", "InCheGenereTiIdentifichi", "Eta", "LuogoDiResidenza", "TitoloDiStudio", "Occupazione", "TiRitieniUnLettore", "QualIlGenereChePreferisciLeggerepuoiSelezionarePiDiUnaRisposta", "ConQualeSupportoPreferisciLeggereSelezionaTuttiQuelliCheUsi", "SeTiVieneRegalatoUnLibriSeiesempioANataleCompleannoEcc", "PreferisciCompareLibri", "IlPrezzoDiUnLibroTiFrenaDalComprarlo", "QualIlPrezzoMassimoCheSeiDispostoASpenderePerUnLibro", "QuantiLibriCompriInMediaInUnAnnoTraUsatiENuoviScrivereIlNumeroI", "OltreAComprareLibriQualiAltriMezziUtilizzipuoiSelezionarePiDiUn", "QuantiLibriLeggiInMediaInUnAnnoScrivereIlNumeroInteroEsempio25", "PreferisciCompareLibri1", "MediamenteASettimanaQuantoTempoPassiALeggere", "HaiUnAccountAttivoSuQualeDiQuestiSocialcioEntriDentroLappGiorna", "UsiUnoDiQuestiAccountPerParlareDiLibriseiUnBookinfluencer", "UsiUnoDiQuestiAccountSoloPerCercareConsigliSuiLibrinonSeiUnBook", "SeHaiRispostoSAdAlmenoUnaDelleDueSpecificaQuali", "TiRitieniParteDiUnaComunitLibrosaOnlineBookTubeBookstagramBookT", "SpecificaQualeanchePiDiUna", "ConosciBooktok", "QuantoTempoPassiGiornalmenteSuTiktok", "QuandoHaiConosciutobooktokscriviSoloLannoYyyy", "QuantoSonoCambiateLeTueAbitudiniDiLetturaDaQuandoSeiEntratoNelB", "HaiMaiPartecipatoAUnaLiveDiLettura", "CosaTiPiaceDiQuesteLive", "HaiMaiPartecipatoAUnGDLgruppoDiLettura", "CosaTiPiaceDiQuestiGDL", "DuranteLaLetturaDiUnLibro", "AscoltiVolentieriRecensioniParlateDi1MinutoOPi", "CosaTiHaConvintoARimanereLaPrimaVoltaCheHaiConosciutoBookTokRis", "PreferisciLeggere", "QualIlTuoBookinfluencerPreferito", "Da1A5ConQuantaFrequenzaTiCapitanoNeiperTeONelfeedVideoOPostDelB", "Da1A5QuantoPensiCheIlBookTokBookstagramBookTubeAbbiaInfluitoSul", "PrimaDiComprareUnLibroQuantoTiBasiSuiPareriDelBookTokBooktubeEB", "CompriLibriCheHannoSullaCopertinaScrittofenomenoDiBookTokOroman", "CompriELeggiUnLibroAncheSeStatoDefinitobruttoDaUnBookinfluencer", "ComeScegliILibriDaComprarePuoiSelezionarePiDiUnaRisposta", "LeggiLibriPerchInQuelMomentoVannoDiModa", "DopoAverFinitoUnLibroCheTiPiaciutoMoltoCosaFaiPuoiMetterePiDiUn", "DopoAverFinitoUnLibroCheNonTiPiaciutoMoltoCosaFaiPuSelezionareP", "ConsideraGliUltimiDodiciMesiTiCapitatoDiComprareDeiLibriSuggeri", "Var48", "Var49"];
opts.SelectedVariableNames = ["InformazioniCronologiche", "InCheGenereTiIdentifichi", "Eta", "LuogoDiResidenza", "TitoloDiStudio", "Occupazione", "TiRitieniUnLettore", "QualIlGenereChePreferisciLeggerepuoiSelezionarePiDiUnaRisposta", "ConQualeSupportoPreferisciLeggereSelezionaTuttiQuelliCheUsi", "SeTiVieneRegalatoUnLibriSeiesempioANataleCompleannoEcc", "PreferisciCompareLibri", "IlPrezzoDiUnLibroTiFrenaDalComprarlo", "QualIlPrezzoMassimoCheSeiDispostoASpenderePerUnLibro", "QuantiLibriCompriInMediaInUnAnnoTraUsatiENuoviScrivereIlNumeroI", "OltreAComprareLibriQualiAltriMezziUtilizzipuoiSelezionarePiDiUn", "QuantiLibriLeggiInMediaInUnAnnoScrivereIlNumeroInteroEsempio25", "PreferisciCompareLibri1", "MediamenteASettimanaQuantoTempoPassiALeggere", "HaiUnAccountAttivoSuQualeDiQuestiSocialcioEntriDentroLappGiorna", "UsiUnoDiQuestiAccountPerParlareDiLibriseiUnBookinfluencer", "UsiUnoDiQuestiAccountSoloPerCercareConsigliSuiLibrinonSeiUnBook", "SeHaiRispostoSAdAlmenoUnaDelleDueSpecificaQuali", "TiRitieniParteDiUnaComunitLibrosaOnlineBookTubeBookstagramBookT", "SpecificaQualeanchePiDiUna", "ConosciBooktok", "QuantoTempoPassiGiornalmenteSuTiktok", "QuandoHaiConosciutobooktokscriviSoloLannoYyyy", "QuantoSonoCambiateLeTueAbitudiniDiLetturaDaQuandoSeiEntratoNelB", "HaiMaiPartecipatoAUnaLiveDiLettura", "CosaTiPiaceDiQuesteLive", "HaiMaiPartecipatoAUnGDLgruppoDiLettura", "CosaTiPiaceDiQuestiGDL", "DuranteLaLetturaDiUnLibro", "AscoltiVolentieriRecensioniParlateDi1MinutoOPi", "CosaTiHaConvintoARimanereLaPrimaVoltaCheHaiConosciutoBookTokRis", "PreferisciLeggere", "QualIlTuoBookinfluencerPreferito", "Da1A5ConQuantaFrequenzaTiCapitanoNeiperTeONelfeedVideoOPostDelB", "Da1A5QuantoPensiCheIlBookTokBookstagramBookTubeAbbiaInfluitoSul", "PrimaDiComprareUnLibroQuantoTiBasiSuiPareriDelBookTokBooktubeEB", "CompriLibriCheHannoSullaCopertinaScrittofenomenoDiBookTokOroman", "CompriELeggiUnLibroAncheSeStatoDefinitobruttoDaUnBookinfluencer", "ComeScegliILibriDaComprarePuoiSelezionarePiDiUnaRisposta", "LeggiLibriPerchInQuelMomentoVannoDiModa", "DopoAverFinitoUnLibroCheTiPiaciutoMoltoCosaFaiPuoiMetterePiDiUn", "DopoAverFinitoUnLibroCheNonTiPiaciutoMoltoCosaFaiPuSelezionareP", "ConsideraGliUltimiDodiciMesiTiCapitatoDiComprareDeiLibriSuggeri"];
opts.VariableTypes = ["categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "string", "categorical", "string", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "string", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "string", "string"];

% Specify file level properties
opts.ExtraColumnsRule = "ignore";
opts.EmptyLineRule = "read";

% Specify variable properties
opts = setvaropts(opts, ["QuantiLibriCompriInMediaInUnAnnoTraUsatiENuoviScrivereIlNumeroI", "QuantiLibriLeggiInMediaInUnAnnoScrivereIlNumeroInteroEsempio25", "QuandoHaiConosciutobooktokscriviSoloLannoYyyy", "Var48", "Var49"], "WhitespaceRule", "preserve");
opts = setvaropts(opts, ["InformazioniCronologiche", "InCheGenereTiIdentifichi", "Eta", "LuogoDiResidenza", "TitoloDiStudio", "Occupazione", "TiRitieniUnLettore", "QualIlGenereChePreferisciLeggerepuoiSelezionarePiDiUnaRisposta", "ConQualeSupportoPreferisciLeggereSelezionaTuttiQuelliCheUsi", "SeTiVieneRegalatoUnLibriSeiesempioANataleCompleannoEcc", "PreferisciCompareLibri", "IlPrezzoDiUnLibroTiFrenaDalComprarlo", "QualIlPrezzoMassimoCheSeiDispostoASpenderePerUnLibro", "QuantiLibriCompriInMediaInUnAnnoTraUsatiENuoviScrivereIlNumeroI", "OltreAComprareLibriQualiAltriMezziUtilizzipuoiSelezionarePiDiUn", "QuantiLibriLeggiInMediaInUnAnnoScrivereIlNumeroInteroEsempio25", "PreferisciCompareLibri1", "MediamenteASettimanaQuantoTempoPassiALeggere", "HaiUnAccountAttivoSuQualeDiQuestiSocialcioEntriDentroLappGiorna", "UsiUnoDiQuestiAccountPerParlareDiLibriseiUnBookinfluencer", "UsiUnoDiQuestiAccountSoloPerCercareConsigliSuiLibrinonSeiUnBook", "SeHaiRispostoSAdAlmenoUnaDelleDueSpecificaQuali", "TiRitieniParteDiUnaComunitLibrosaOnlineBookTubeBookstagramBookT", "SpecificaQualeanchePiDiUna", "ConosciBooktok", "QuantoTempoPassiGiornalmenteSuTiktok", "QuandoHaiConosciutobooktokscriviSoloLannoYyyy", "QuantoSonoCambiateLeTueAbitudiniDiLetturaDaQuandoSeiEntratoNelB", "HaiMaiPartecipatoAUnaLiveDiLettura", "CosaTiPiaceDiQuesteLive", "HaiMaiPartecipatoAUnGDLgruppoDiLettura", "CosaTiPiaceDiQuestiGDL", "DuranteLaLetturaDiUnLibro", "AscoltiVolentieriRecensioniParlateDi1MinutoOPi", "CosaTiHaConvintoARimanereLaPrimaVoltaCheHaiConosciutoBookTokRis", "PreferisciLeggere", "QualIlTuoBookinfluencerPreferito", "Da1A5ConQuantaFrequenzaTiCapitanoNeiperTeONelfeedVideoOPostDelB", "Da1A5QuantoPensiCheIlBookTokBookstagramBookTubeAbbiaInfluitoSul", "PrimaDiComprareUnLibroQuantoTiBasiSuiPareriDelBookTokBooktubeEB", "CompriLibriCheHannoSullaCopertinaScrittofenomenoDiBookTokOroman", "CompriELeggiUnLibroAncheSeStatoDefinitobruttoDaUnBookinfluencer", "ComeScegliILibriDaComprarePuoiSelezionarePiDiUnaRisposta", "LeggiLibriPerchInQuelMomentoVannoDiModa", "DopoAverFinitoUnLibroCheTiPiaciutoMoltoCosaFaiPuoiMetterePiDiUn", "DopoAverFinitoUnLibroCheNonTiPiaciutoMoltoCosaFaiPuSelezionareP", "ConsideraGliUltimiDodiciMesiTiCapitatoDiComprareDeiLibriSuggeri", "Var48", "Var49"], "EmptyFieldRule", "auto");

% Import the data
BooktTokcosacinascondi = readtable(filename, opts);

% Data Elaboration
% QuantiLibriCompriInMediaInUnAnnoTraUsatiENuoviScrivereIlNumeroI
newCol = elaboraColonnaNumericaAperta(BooktTokcosacinascondi.QuantiLibriCompriInMediaInUnAnnoTraUsatiENuoviScrivereIlNumeroI, true, 300);
BooktTokcosacinascondi.QuantiLibriCompriInMediaInUnAnnoTraUsatiENuoviScrivereIlNumeroI = newCol;

% QuantiLibriLeggiInMediaInUnAnnoScrivereIlNumeroInteroEsempio25
newCol = elaboraColonnaNumericaAperta(BooktTokcosacinascondi.QuantiLibriLeggiInMediaInUnAnnoScrivereIlNumeroInteroEsempio25, true, 300);
BooktTokcosacinascondi.QuantiLibriLeggiInMediaInUnAnnoScrivereIlNumeroInteroEsempio25 = newCol;

% QuandoHaiConosciutobooktokscriviSoloLannoYyyy (ma senza media, solo primo numero)
newCol = elaboraColonnaNumericaAperta(BooktTokcosacinascondi.QuandoHaiConosciutobooktokscriviSoloLannoYyyy, false, 2100);
BooktTokcosacinascondi.QuandoHaiConosciutobooktokscriviSoloLannoYyyy = newCol;



end

function newColum = elaboraColonnaNumericaAperta(colonna, media, maxValue)
    newColum = colonna;
    for ii = 1:numel(colonna)
        newColum(ii) = estraiNumero(colonna(ii), media, maxValue);
    end
    newColum = str2double(newColum);
end


function num = estraiNumero(risposta, media, maxValue)
    num = 0;
    regex = '(\d+)*(\d+)';
    if risposta == ""
        num = missing;
        return
    end
    
    [Nums, numIndex] = regexp(risposta,regex,'match');
    Nums = str2double(Nums);
    if isempty(Nums)
        return
    end
    
    if media
        num = mean(Nums);
    else
        num=Nums(1);
    end

    if num >= maxValue
        num = 0;
    end
end